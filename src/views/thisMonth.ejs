<%- include("./partials/header.ejs"); %>
<%- include("./partials/nav.ejs"); %>

<!-- select a month -->
<!-- expenses/incomes can be pulled from database based on the month they are for -->
<h1><%= month %> </h1>
<form action="/changeMonth" method="POST">
  <input type="month" name="month" value="<%= date.slice(0,7) %>" onChange="this.form.submit()">
</form>
<p>total spending: $<span class="monthTotal" id="totalSpending">00.00</span></p>
<p>total income: $<span class="monthTotal" id="totalIncome">00.00</span></p>
<p>savings: $<span class="monthTotal" id="totalSavings">00.00</span></p>
<!-- populate the table based on the date here defualt should be today -->
<div class="spending">
  <label for="spendingItem">spending</label>
  <form id="spendingItem" class="" action="/spendingItem" method="post">
    <input type="text" name="itemName" placeholder="name" required autofocus>
    <input type="number" step="0.01" name="amount" placeholder="amount" required>
    <select name="category" form="spendingItem">
      <option value="0" default>uncategorized</option>

      <% budgets.forEach(element => { %>
        <option value="<%= element.id %>"> <%= element.category %> </option>
      <% }); %>
      <!-- populates based on budget categories -->
    </select>
    <input type="date" name="date" value="<%= date %>" min="2010-01-01" max="<%= today %>"> <!-- max should be today -->
    <button type="submit" name="button">add</button>
  </form>
  <%-  include("./partials/spendPopEdit", {budgets: budgets});  %>
  <table>
    <thead>
      <tr>
        <td>Description</td>
        <td>Amount</td>
        <td>Category</td>
        <td>Date</td>
      </tr>
    </thead>
    <tbody>
      <% purchases.forEach(element => { %>
        <tr>
          <td><%= element.itmDescription %> </td>
          <td id="spendingAmount">$<%= element.amount %> </td>
          <td><%= getCategoryName(budgets, element.category) %> </td>
          <td><%= formatDate(element.purchaseDate) %> </td>
          <td>
            <button class="editButton"
            itmId = "<%= element.id %> "
            name = "<%= element.itmDescription %>"
            purchaseAmount="<%= element.amount %>"
            categoryId="<%= element.category %>"
            purchaseDate="<%= formatDate(element.purchaseDate) %>"
            >edit
          </button>
          </td>
          <td>
            <form action="/deleteSpendingItm" method="POST">
              <input hidden name="deleteSpendingItm" value="<%= element.id %>">
              <button class="deleteBtn" type="submit">delete</button>
            </form>
        </td>
        </tr>
      <%}); %>
    </tbody>
  </table>
</div>

<div class="income">
  <label for="incomeItem">Income</label>
  <form id="incomeItem" action="/incomeItem" method="post">
    <input type="text" name="itemName" placeholder="name">
    <input type="number" step="0.01" name="amount" placeholder="amount">
    <input type="date" name="date" value="<%= date %>" min="2010-01-01" max="<%= today %>"> <!-- max should be today-->
    <button type="submit" name="button">add</button>
  </form>

  <table>
    <thead>
      <tr>
        <td>Description</td>
        <td>Amount</td>
        <td>Date</td>
      </tr>
    </thead>
    <tbody>
      <% deposits.forEach(element => { %>
        <tr>
          <td><%= element.inDescription %> </td>
          <td id="incomeAmount">$<%= element.amount %> </td>
          <td><%= formatDate(element.depositDate) %> </td>
          <td>
            <form action="/deleteMonthIncomeItm" method="POST">
            <input hidden name="deleteIncomeItm" value="<%= element.id %>">
            <button class="deleteBtn" type="submit" name="deleteBtn">delete</button>
            </form>
          </td>
        </tr>
      <% }); %>
    </tbody>
  </table>
</div>
<%- include("./partials/footer.ejs"); %>
<script src="./js/thisMonthTotal.js" ></script>
